#!/bin/bash

# List of block numbers to reimport
# Session blocks (SessionReportReceived events)
blocks=(11448619 11449145 11449656 11450186 11450718 11451267 11451817 11452355 11452901 11453460 11454019 11454566 11455121 11455663 11456213 11456759 11457317 11457874 11458412 11458958 11459513 11460058 11460612 11461164 11461715 11462254 11462794 11463350 11463869 11464381 11464905 11465441 11465959 11466496 11467010 11467521 11468046 11468577 11469107 11469623 11470157 11470686 11471215 11471743 11472278 11472805 11473333 11473862 11474394 11474930 11475473 11476023 11476578 11477106 11477653 11478200 11478737 11479285 11479823 11480363 11480897 11481444 11481985 11482538 11483086 11483626 11484163 11484715 11485269 11485805 11486350 11486889 11487439 11487981 11488520 11489049 11489585 11490128 11490673 11491205 11491728 11492262 11492803 11493334 11493877 11494414 11494942 11495476 11496016 11496568 11497104 11497657 11498207 11498746 11499278 11499811 11500345 11500882 11501414 11501958)

# Election blocks (PhaseTransitioned events) - 102 blocks from Subscan
# Fetched from: https://assethub-kusama.subscan.io/event?module=multiblockelection&event_id=phasetransitioned
# Filtered to range: 11448619-11501958 (matching session blocks)
# These blocks contain MultiBlockElection.PhaseTransitioned events for election tracking
election_blocks=(11501803 11501788 11501738 11501481 11501431 11501414 11498596 11498581 11498531 11498274 11498224 11498207 11495331 11495316 11495266 11495009 11494959 11494942 11492117 11492102 11492052 11491795 11491745 11491728 11488909 11488894 11488844 11488587 11488537 11488520 11485658 11485643 11485593 11485336 11485286 11485269 11482374 11482359 11482309 11482052 11482002 11481985 11479126 11479111 11479061 11478804 11478754 11478737 11475862 11475847 11475797 11475540 11475490 11475473 11472667 11472652 11472602 11472345 11472295 11472278 11469496 11469481 11469431 11469174 11469124 11469107 11466348 11466333 11466283 11466026 11465976 11465959 11463183 11463168 11463118 11462861 11462811 11462794 11459902 11459887 11459837 11459580 11459530 11459513 11456602 11456587 11456537 11456280 11456230 11456213 11453290 11453275 11453225 11452968 11452918 11452901 11450045 11450030 11449980 11449723 11449673 11449656)

# Inflation blocks (EraPaid events)
# 11502501 - Staking.EraPaid event
inflation_blocks=(11502501)

# Combine all blocks and remove duplicates
all_blocks=($(echo "${blocks[@]} ${election_blocks[@]} ${inflation_blocks[@]}" | tr ' ' '\n' | sort -n | uniq))

total=${#all_blocks[@]}
count=0

echo "Starting batch reimport of $total blocks..."
echo "  - Session blocks: ${#blocks[@]}"
echo "  - Election blocks: ${#election_blocks[@]}"
echo "  - Inflation blocks: ${#inflation_blocks[@]}"
echo ""

for block in "${all_blocks[@]}"; do
  ((count++))
  percent=$((count * 100 / total))
  echo "[$count/$total - $percent%] Reimporting block $block..."

  npm run reimport $block 2>&1 | grep -E "✅|❌|Created/updated session|Created new era" | head -n 5

  if [ $? -eq 0 ]; then
    echo "  ✓ Success"
  else
    echo "  ✗ Failed"
  fi
  echo ""
done

echo "Batch reimport completed! Processed $total blocks."
